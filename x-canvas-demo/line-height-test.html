<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>行高测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, sans-serif;
            background: #f5f5f5;
        }
        
        .container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .panel {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .canvas-container {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        
        #renderCanvas {
            display: block;
            width: 100%;
            height: 400px;
        }
        
        #highlightLayer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .highlight-bar {
            position: absolute;
            background: rgba(255, 255, 0, 0.3);
            border-radius: 2px;
        }
        
        .anchor {
            position: absolute;
            width: 10px;
            height: 36px;
            background: #007AFF;
            border-radius: 5px;
            pointer-events: none;
            display: none;
        }
        
        .controls {
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 10px;
        }
        
        label {
            display: inline-block;
            width: 120px;
            font-weight: 500;
        }
        
        input[type="range"] {
            width: 200px;
        }
        
        .value-display {
            margin-left: 10px;
            font-family: monospace;
            color: #666;
        }
        
        .reference {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .reference h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h3>Canvas 渲染器测试</h3>
            
            <div class="controls">
                <div class="control-group">
                    <label>字体大小:</label>
                    <input type="range" id="fontSizeSlider" min="12" max="32" value="20">
                    <span class="value-display" id="fontSizeValue">20px</span>
                </div>
                
                <div class="control-group">
                    <label>行高倍数:</label>
                    <input type="range" id="lineHeightSlider" min="1" max="3" step="0.1" value="1.4">
                    <span class="value-display" id="lineHeightValue">1.4</span>
                </div>
                
                <div class="control-group">
                    <label>内边距:</label>
                    <input type="range" id="paddingSlider" min="10" max="40" value="16">
                    <span class="value-display" id="paddingValue">16px</span>
                </div>
                
                <div class="control-group">
                    <label>文本对齐:</label>
                    <select id="textAlignSelect">
                        <option value="left">左对齐</option>
                        <option value="center">居中对齐</option>
                        <option value="right">右对齐</option>
                        <option value="justify">两端对齐</option>
                    </select>
                </div>
            </div>
            
            <div class="canvas-container">
                <canvas id="renderCanvas"></canvas>
                <div id="highlightLayer"></div>
                <div id="startAnchor" class="anchor"></div>
                <div id="endAnchor" class="anchor"></div>
            </div>
            
            <div class="reference">
                <h4>测试说明</h4>
                <p>这个测试验证了CSS行高的正确实现：</p>
                <ul>
                    <li><strong>行高 = 字体大小 × 行高倍数</strong></li>
                    <li><strong>文本基线位置</strong>：位于行高的约80%处</li>
                    <li><strong>行间距</strong>：行高减去字体大小</li>
                    <li>调整滑块可以看到行高变化的效果</li>
                </ul>
            </div>
        </div>
        
        <div class="panel">
            <h3>HTML 参考对比</h3>
            <div id="htmlReference" style="padding: 16px; border: 1px solid #ddd; border-radius: 4px; height: 400px; overflow-y: auto; font-size: 20px; line-height: 1.4;">
                <h4>CHAPTER ONE</h4>
                <p><b><i>The Boy Who Lived</i></b></p>
                <p>Mr and Mrs Dursley, of number four, Privet Drive, were proud to say that they were perfectly normal, thank you very much.</p>
                <p>'No,' she said sharply. 'Why?'</p>
                <p>'Funny stuff on the news,' Mr Dursley mumbled. 'Owls... shooting stars... and there were a lot of funny-looking people in town today...'</p>
                <p>'<i>So</i>?' snapped Mrs Dursley.</p>
                <p>'Well, I just thought... maybe... it was something to do with... you know... <i>her lot</i>.'</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { VirtualCanvasRenderer } from '../x-canvas/virtual-canvas-renderer.js';

        // 测试HTML内容
        const testHTML = `
            <h4>CHAPTER ONE</h4>
            <p><b><i>The Boy Who Lived</i></b></p>
            <p>Mr and Mrs Dursley, of number four, Privet Drive, were proud to say that they were perfectly normal, thank you very much.</p>
            <p>'No,' she said sharply. 'Why?'</p>
            <p>'Funny stuff on the news,' Mr Dursley mumbled. 'Owls... shooting stars... and there were a lot of funny-looking people in town today...'</p>
            <p>'<i>So</i>?' snapped Mrs Dursley.</p>
            <p>'Well, I just thought... maybe... it was something to do with... you know... <i>her lot</i>.'</p>
        `;

        // 初始化渲染器
        const container = document.getElementById('renderCanvas').parentElement;
        const renderer = new VirtualCanvasRenderer({
            mountPoint: container,
            mode: 'vertical',
            theme: {
                baseFontSize: 20,
                lineHeight: 1.4,
                paddingX: 16,
                paddingY: 16,
                backgroundColor: '#fff',
                textColor: '#222'
            }
        });

        // 控件引用
        const fontSizeSlider = document.getElementById('fontSizeSlider');
        const lineHeightSlider = document.getElementById('lineHeightSlider');
        const paddingSlider = document.getElementById('paddingSlider');
        const textAlignSelect = document.getElementById('textAlignSelect');
        const fontSizeValue = document.getElementById('fontSizeValue');
        const lineHeightValue = document.getElementById('lineHeightValue');
        const paddingValue = document.getElementById('paddingValue');
        const htmlReference = document.getElementById('htmlReference');

        // 更新显示值
        function updateValues() {
            fontSizeValue.textContent = fontSizeSlider.value + 'px';
            lineHeightValue.textContent = lineHeightSlider.value;
            paddingValue.textContent = paddingSlider.value + 'px';
        }

        // 更新渲染
        function updateRender() {
            const fontSize = parseInt(fontSizeSlider.value);
            const lineHeight = parseFloat(lineHeightSlider.value);
            const padding = parseInt(paddingSlider.value);
            const textAlign = textAlignSelect.value;

            // 更新Canvas渲染器主题
            renderer.setTheme({
                baseFontSize: fontSize,
                lineHeight: lineHeight,
                paddingX: padding,
                paddingY: padding
            });

            // 创建带有文本对齐样式的HTML内容
            const styledHTML = `
                <style>
                    p { text-align: ${textAlign}; }
                    h4 { text-align: ${textAlign}; }
                </style>
                ${testHTML}
            `;

            // 渲染内容
            renderer.render(styledHTML);

            // 更新HTML参考
            htmlReference.style.fontSize = fontSize + 'px';
            htmlReference.style.lineHeight = lineHeight;
            htmlReference.style.padding = padding + 'px';
            htmlReference.style.textAlign = textAlign;
        }

        // 事件监听
        fontSizeSlider.addEventListener('input', () => {
            updateValues();
            updateRender();
        });

        lineHeightSlider.addEventListener('input', () => {
            updateValues();
            updateRender();
        });

        paddingSlider.addEventListener('input', () => {
            updateValues();
            updateRender();
        });
        
        textAlignSelect.addEventListener('change', () => {
            updateRender();
        });

        // 初始化
        updateValues();
        updateRender();

        // 调试信息
        console.log('渲染结果:', renderer.getRenderResult());
        console.log('页面样式:', renderer.getPageStyle());
    </script>
</body>
</html>