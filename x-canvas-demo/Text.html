<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <canvas
      id="c"
      width="300"
      height="800"
      style="border: 1px solid #ccc"></canvas>
    <script>
      const canvas = document.getElementById('c');
      const ctx = canvas.getContext('2d');

      ctx.font = '20px Arial';
      ctx.fillStyle = 'black';
      ctx.textBaseline = 'top';

      const text =
        "Canvas doesn't support automatic text wrapping, " +
        'so we need to implement multi-line text layout manually. ' +
        'Each line should be centered, just like CSS text-align: center.';

      // 1. 手动换行函数
      function wrapText(ctx, text, maxWidth) {
        const words = text.split(' ');
        let line = '';
        const lines = [];

        for (let i = 0; i < words.length; i++) {
          const testLine = line + words[i] + ' ';
          const testWidth = ctx.measureText(testLine).width;
          if (testWidth > maxWidth && line !== '') {
            lines.push(line.trim());
            line = words[i] + ' ';
          } else {
            line = testLine;
          }
        }
        lines.push(line.trim());
        return lines;
      }

      // 2. 获取多行文本
      const maxWidth = 300;
      const lineHeight = 28;
      const lines = wrapText(ctx, text, maxWidth);
      ctx.textAlign = 'center';

      // 3. 居中绘制
      lines.forEach((line, i) => {
        const lineWidth = ctx.measureText(line).width;
        const x = canvas.width / 2;
        const y = 50 + i * lineHeight;

        ctx.fillText(line, x, y);
      });
    </script>
  </body>
</html>
